# 以太坊交易查询工具包

本工具包含多个脚本，用于查询以太坊交易信息，包括批量查询和详细信息查询。

## 可用的RPC端点

根据当前运行的以太坊网络，以下RPC端点可用：

- `http://127.0.0.1:32769` - Geth节点
- `http://127.0.0.1:32788` - Nethermind节点  
- `http://127.0.0.1:32783` - Reth节点
- `http://127.0.0.1:32778` - Besu节点
- `http://127.0.0.1:32774` - Erigon节点

## 脚本说明

### 1. batch_tx_query.py (Python版本 - 批量查询)
- **语言**: Python 3.6+
- **功能**: 批量查询多个交易哈希的状态
- **特点**: 支持多线程并发查询，效率更高，结果分组显示
- **输出**: 控制台显示 + JSON文件保存
- **依赖**: requests库

### 2. query_tx.sh (Bash版本 - 批量查询)
- **语言**: Bash
- **功能**: 批量查询多个交易哈希的状态
- **特点**: 无需额外依赖，轻量级，结果分组显示
- **输出**: 控制台显示
- **依赖**: curl命令

### 3. tx_detail_query.py (Python版本 - 详细查询)
- **语言**: Python 3.6+
- **功能**: 查询单个交易的详细信息
- **特点**: 显示完整的交易信息、收据、区块信息和地址余额
- **输出**: 控制台显示，格式化输出
- **依赖**: requests库

### 4. tx_detail_query.sh (Bash版本 - 详细查询)
- **语言**: Bash
- **功能**: 查询单个交易的详细信息
- **特点**: 无需额外依赖，轻量级，彩色输出
- **输出**: 控制台显示，格式化输出
- **依赖**: curl命令

## 使用方法

### 批量查询脚本

#### Python版本 (batch_tx_query.py)

```bash
# 安装依赖
pip install requests

# 查询单个交易哈希
python3 batch_tx_query.py 0x1234567890abcdef1234567890abcdef1234567890abcdef1234567890abcdef

# 从文件批量查询
python3 batch_tx_query.py tx_hashes.txt

# 查询预设的示例交易
python3 batch_tx_query.py
```

#### Bash版本 (query_tx.sh)

```bash
# 添加执行权限
chmod +x query_tx.sh

# 查询单个交易哈希
./query_tx.sh 0x1234567890abcdef1234567890abcdef1234567890abcdef1234567890abcdef

# 从文件批量查询
./query_tx.sh tx_hashes.txt

# 查询预设的示例交易
./query_tx.sh
```

### 详细查询脚本

#### Python版本 (tx_detail_query.py)

```bash
# 安装依赖
pip install requests

# 查询交易详细信息
python3 tx_detail_query.py 0x1234567890abcdef1234567890abcdef1234567890abcdef1234567890abcdef
```

#### Bash版本 (tx_detail_query.sh)

```bash
# 添加执行权限
chmod +x tx_detail_query.sh

# 查询交易详细信息
./tx_detail_query.sh 0x1234567890abcdef1234567890abcdef1234567890abcdef1234567890abcdef
```

## 交易哈希文件格式

创建一个文本文件（如 `my_tx_hashes.txt`），每行一个交易哈希：

```
0x1234567890abcdef1234567890abcdef1234567890abcdef1234567890abcdef
0xabcdef1234567890abcdef1234567890abcdef1234567890abcdef1234567890
0x9876543210fedcba9876543210fedcba9876543210fedcba9876543210fedcba
```

**注意：**
- 以 `#` 开头的行会被忽略（注释行）
- 空行会被忽略
- 交易哈希必须是完整的64位十六进制字符串（加上0x前缀）

## 查询结果说明

### 批量查询结果分组

批量查询脚本现在将结果按以下类别分组显示：

#### 存在的交易
- **已确认成功**: 交易已被确认并执行成功
- **已确认失败**: 交易已被确认但执行失败  
- **待确认**: 交易在内存池中，等待确认

#### 不存在的交易
- **不存在**: 交易哈希不存在或无效

### 详细查询结果内容

详细查询脚本提供完整的交易信息：

#### 基本交易信息
- 交易哈希、区块哈希、区块号
- 发送方和接收方地址
- 转账金额、Nonce值
- 交易在区块中的索引

#### Gas信息
- Gas限制和实际使用量
- Gas价格（Wei和Gwei格式）
- Gas使用效率
- 交易费用计算

#### 输入数据
- 输入数据长度和内容
- 函数选择器（智能合约调用）
- 数据预览（长数据截断显示）

#### 交易执行结果
- 执行状态（成功/失败）
- 实际Gas消耗
- 事件日志数量
- 区块累积Gas使用

#### 区块信息
- 区块基本信息（号码、哈希、时间戳）
- 矿工/验证者地址
- 区块大小和Gas使用情况
- 区块中交易数量

#### 地址余额
- 发送方当前余额
- 接收方当前余额

## 示例输出

### 批量查询输出示例

#### Python版本 (batch_tx_query.py)
```
🔍 以太坊交易批量查询工具
================================================================================

🔗 测试RPC连接...
✅ http://127.0.0.1:32769 连接成功
✅ http://127.0.0.1:32788 连接成功
✅ http://127.0.0.1:32783 连接成功
✅ http://127.0.0.1:32778 连接成功
✅ http://127.0.0.1:32774 连接成功

📊 开始查询 3 个交易哈希...

🔍 查询结果分组:
================================================================================

✅ 存在的交易 (1个):
--------------------------------------------------
已确认成功 (1个):
  • 0xabc123... (区块: 12345, Gas: 21000)

❌ 不存在的交易 (2个):
--------------------------------------------------
  • 0x1234567890abcdef...
  • 0xdef456789abcdef0...

📈 查询统计:
================================================================================
总查询数: 3
存在交易: 1 (33.3%)
  - 已确认成功: 1
  - 已确认失败: 0  
  - 待确认: 0
不存在交易: 2 (66.7%)
查询成功率: 100.0%

💾 结果已保存到: tx_query_results.json
```

#### Bash版本 (query_tx.sh)
```
🔍 以太坊交易批量查询工具 (Bash版本)
================================================================================

🔗 测试RPC连接...
✅ http://127.0.0.1:32769 连接成功
✅ http://127.0.0.1:32788 连接成功
✅ http://127.0.0.1:32783 连接成功
✅ http://127.0.0.1:32778 连接成功
✅ http://127.0.0.1:32774 连接成功

📊 开始查询交易...

🔍 查询结果分组:
================================================================================

✅ 存在的交易:
--------------------------------------------------
已确认交易 (1个):
  • 0xabc123... (区块: 12345)

❌ 不存在的交易:
--------------------------------------------------
不存在的交易 (2个):
  • 0x1234567890abcdef...
  • 0xdef456789abcdef0...

📈 查询统计:
================================================================================
总查询数: 3
存在交易: 1
不存在交易: 2
查询成功率: 100%
```

### 详细查询输出示例

#### 交易详情查询 (tx_detail_query.py/sh)
```
🔍 以太坊交易详情查询工具
================================================================================

🔍 测试RPC连接...
✅ 使用RPC端点: http://127.0.0.1:32769

================================================================================
交易详情查询: 0xabc123...
================================================================================

📋 基本交易信息:
--------------------------------------------------
交易哈希: 0xabc123...
区块哈希: 0xdef456...
区块号: 12,345
交易索引: 0
发送方: 0x742d35Cc6634C0532925a3b8D4C0C8b3C2e1e1e1
接收方: 0x8ba1f109551bD432803012645Hac136c9c1e1e1e
转账金额: 1.500000 ETH
Nonce: 42

⛽ Gas信息:
--------------------------------------------------
Gas限制: 21,000 Gas
Gas价格: 20.00 Gwei (20,000,000,000 Wei)
实际Gas使用: 21,000 Gas
Gas效率: 100.00% (21,000/21,000)
交易费用: 0.000420 ETH (420,000,000,000,000 Wei)

📝 输入数据:
--------------------------------------------------
无输入数据 (简单转账)

📊 交易执行结果:
--------------------------------------------------
✅ 交易执行成功
事件日志: 0 个事件

🏗️ 区块信息:
--------------------------------------------------
区块号: 12,345
区块哈希: 0xdef456...
矿工/验证者: 0x1234567890123456789012345678901234567890
时间戳: 2024-01-15 10:30:45 (1705312245)
区块大小: 1,024 字节
区块Gas使用率: 85.50%
交易数量: 15

💰 地址余额信息:
--------------------------------------------------
发送方余额: 10.250000 ETH (0x742d35Cc...)
接收方余额: 5.750000 ETH (0x8ba1f109...)

================================================================================
✅ 查询完成
```

## 性能优化建议

1. **并发控制：** Python版本默认使用5个并发线程，可以根据网络情况调整
2. **请求频率：** Bash版本在每次查询间添加了0.1秒延迟，避免过于频繁的请求
3. **端点选择：** 工具会自动测试并使用可用的RPC端点
4. **批量大小：** 建议每批查询不超过100个交易哈希

## 故障排除

### 常见问题

1. **所有RPC端点连接失败**
   - 检查以太坊网络是否正在运行
   - 确认端口号是否正确（查看 `output.txt` 获取最新端口）
   - 检查防火墙设置

2. **Python依赖缺失**
   ```bash
   pip3 install requests
   ```

3. **权限问题**
   ```bash
   chmod +x batch_tx_query.py
   chmod +x query_tx.sh
   ```

4. **交易哈希格式错误**
   - 确保哈希以 `0x` 开头
   - 确保哈希长度为66个字符（0x + 64位十六进制）

### 调试模式

如需查看详细的RPC调用信息，可以修改脚本中的调试选项或使用curl直接测试：

```bash
# 测试RPC连接
curl -X POST -H "Content-Type: application/json" \
  --data '{"jsonrpc":"2.0","method":"eth_blockNumber","params":[],"id":1}' \
  http://127.0.0.1:32769

# 查询特定交易
curl -X POST -H "Content-Type: application/json" \
  --data '{"jsonrpc":"2.0","method":"eth_getTransactionByHash","params":["0x你的交易哈希"],"id":1}' \
  http://127.0.0.1:32769
```

## 文件说明

### 批量查询脚本
- `batch_tx_query.py` - Python版本的批量查询脚本
- `query_tx.sh` - Bash版本的批量查询脚本

### 详细查询脚本
- `tx_detail_query.py` - Python版本的交易详情查询脚本
- `tx_detail_query.sh` - Bash版本的交易详情查询脚本

### 配置和示例文件
- `sample_tx_hashes.txt` - 示例交易哈希文件模板

### 输出文件
- `tx_query_results.json` - Python批量查询脚本生成的查询结果文件

### 文档
- `TX_QUERY_README.md` - 本说明文档

## 更新端口信息

如果重新启动了以太坊网络，端口可能会发生变化。请查看 `output.txt` 文件获取最新的端口信息，并相应更新脚本中的 `RPC_ENDPOINTS` 列表。